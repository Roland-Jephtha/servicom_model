{% extends 'dashboard/base.html' %}

{% block content %}
{% load static %}

<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">

            <div class="row">
                <div class="col">
                    <div class="h-100">
                        <!-- Welcome Header -->
                        <div class="row mb-4 pb-1">
                            <div class="col-12">
                                <div class="d-flex align-items-center flex-column flex-md-row">
                                    <div class="flex-grow-1">
                                        <h4 class="fs-16 mb-1">Good {{ greeting_time }}, {{ user.get_full_name|default:user.username }}!</h4>
                                        <p class="text-muted mb-0">Here's what's happening with your complaints today.</p>
                                    </div>
                                    <div class="mt-3 mt-md-0">
                                        <a href="{% url 'submit_complaint' %}" class="btn btn-primary btn-hover-shadow">
                                            <i class="ri-add-line align-middle me-1"></i> Submit New Complaint
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Stats Cards -->
                        <div class="row">
                            <div class="col-xl-3 col-md-6">
                                <div class="card card-animate">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-grow-1 overflow-hidden">
                                                <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Total Complaints</p>
                                            </div>
                                            <div class="flex-shrink-0">
                                                <span class="badge bg-soft-success text-success">+{{ new_complaints_today }} Today</span>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-end justify-content-between mt-4">
                                            <div>
                                                <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="{{ total_complaints }}">0</span></h4>
                                                <span class="badge bg-soft-primary text-primary">All Time</span>
                                            </div>
                                            <div class="avatar-sm flex-shrink-0">
                                                <span class="avatar-title bg-soft-primary rounded fs-3">
                                                    <i class="ri-file-list-3-line text-primary"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-3 col-md-6">
                                <div class="card card-animate">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-grow-1 overflow-hidden">
                                                <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Pending</p>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-end justify-content-between mt-4">
                                            <div>
                                                <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="{{ pending_complaints }}">0</span></h4>
                                                <span class="badge bg-soft-warning text-warning">Needs Attention</span>
                                            </div>
                                            <div class="avatar-sm flex-shrink-0">
                                                <span class="avatar-title bg-soft-warning rounded fs-3">
                                                    <i class="ri-time-line text-warning"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-3 col-md-6">
                                <div class="card card-animate">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-grow-1 overflow-hidden">
                                                <p class="text-uppercase fw-medium text-muted text-truncate mb-0">In Progress</p>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-end justify-content-between mt-4">
                                            <div>
                                                <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="{{ in_progress_complaints }}">0</span></h4>
                                                <span class="badge bg-soft-info text-info">Being Addressed</span>
                                            </div>
                                            <div class="avatar-sm flex-shrink-0">
                                                <span class="avatar-title bg-soft-info rounded fs-3">
                                                    <i class="ri-loader-4-line text-info"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-3 col-md-6">
                                <div class="card card-animate">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-grow-1 overflow-hidden">
                                                <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Resolved</p>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-end justify-content-between mt-4">
                                            <div>
                                                <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="{{ resolved_complaints }}">0</span></h4>
                                                <span class="badge bg-soft-success text-success">Completed</span>
                                            </div>
                                            <div class="avatar-sm flex-shrink-0">
                                                <span class="avatar-title bg-soft-success rounded fs-3">
                                                    <i class="ri-checkbox-circle-line text-success"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Complaints -->
                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-header bg-transparent border-bottom-0 d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0">Your Recent Complaints</h5>
                                        <a href="{% url 'my_complaints' %}" class="btn btn-sm btn-soft-primary btn-hover">
                                            View All <i class="ri-arrow-right-line align-middle ms-1"></i>
                                        </a>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive table-card">
                                            <table class="table table-borderless table-centered table-hover mb-0">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Reference #</th>
                                                        <th>Type</th>

                                                        <th>Status</th>
                                                        <th>Date Submitted</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for complaint in user_complaints %}
                                                    <tr>
                                                        <td>
                                                            <a href="{% url 'track_complaint' reference=complaint.reference %}" class="text-primary fw-semibold">
                                                                #{{ complaint.reference }}
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <span class="badge bg-soft-secondary text-secondary">
                                                                <i class="{% if complaint.type == 'technical' %}ri-computer-line
                                                                    {% elif complaint.type == 'billing' %}ri-money-dollar-circle-line
                                                                    {% elif complaint.type == 'service' %}ri-customer-service-2-line
                                                                    {% else %}ri-error-warning-line{% endif %} align-middle me-1">
                                                                </i>
                                                                {{ complaint.type|title }}
                                                            </span>
                                                        </td>
                                   
                                                        <td>
                                                            <span class="badge {% if complaint.status == 'resolved' %}bg-success
                                                                {% elif complaint.status == 'in_progress' %}bg-warning
                                                                {% elif complaint.status == 'pending' %}bg-danger
                                                                {% else %}bg-secondary{% endif %}">
                                                                <i class="{% if complaint.status == 'resolved' %}ri-checkbox-circle-line
                                                                    {% elif complaint.status == 'in_progress' %}ri-loader-4-line
                                                                    {% elif complaint.status == 'pending' %}ri-time-line
                                                                    {% else %}ri-error-warning-line{% endif %} align-middle me-1">
                                                                </i>
                                                                {{ complaint.status|title }}
                                                            </span>
                                                        </td>
                                                        <td>{{ complaint.created_at|date:"M d, Y" }}</td>
                                                        <td>
                                                            <a href="{% url 'track_complaint' reference=complaint.reference %}" class="btn btn-sm btn-light btn-hover">
                                                                <i class="ri-eye-line"></i> View Details
                                                            </a>
                                                        </td>
                                                    </tr>
                                                    {% empty %}
                                                    <tr>
                                                        <td colspan="6" class="text-center py-4">
                                                            <div class="text-muted">
                                                                <i class="ri-inbox-line display-4"></i>
                                                                <h5 class="mt-2">No complaints found</h5>
                                                                <p>Get started by submitting your first complaint</p>
                                                                <a href="{% url 'submit_complaint' %}" class="btn btn-primary mt-2">
                                                                    <i class="ri-add-line align-middle me-1"></i> Submit Complaint
                                                                </a>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-header bg-transparent border-bottom-0 d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0">Quick Actions</h5>
                                        <i class="ri-flashlight-line text-warning"></i>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3 col-sm-6 mb-3">
                                                <a href="{% url 'submit_complaint' %}" class="btn btn-action-card">
                                                    <div class="card action-card h-100">
                                                        <div class="card-body text-center">
                                                            <div class="avatar-sm mx-auto mb-3">
                                                                <span class="avatar-title bg-soft-primary text-primary rounded fs-4">
                                                                    <i class="ri-megaphone-line"></i>
                                                                </span>
                                                            </div>
                                                            <h5 class="fs-16">Submit Complaint</h5>
                                                            <p class="text-muted mb-0">Report a new issue</p>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                            <div class="col-md-3 col-sm-6 mb-3">
                                                <a href="{% url 'my_complaints' %}" class="btn btn-action-card">
                                                    <div class="card action-card h-100">
                                                        <div class="card-body text-center">
                                                            <div class="avatar-sm mx-auto mb-3">
                                                                <span class="avatar-title bg-soft-info text-info rounded fs-4">
                                                                    <i class="ri-file-list-3-line"></i>
                                                                </span>
                                                            </div>
                                                            <h5 class="fs-16">My Complaints</h5>
                                                            <p class="text-muted mb-0">View all your complaints</p>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                            <div class="col-md-3 col-sm-6 mb-3">
                                                <a href="{% url 'profile' %}" class="btn btn-action-card">
                                                    <div class="card action-card h-100">
                                                        <div class="card-body text-center">
                                                            <div class="avatar-sm mx-auto mb-3">
                                                                <span class="avatar-title bg-soft-success text-success rounded fs-4">
                                                                    <i class="ri-user-settings-line"></i>
                                                                </span>
                                                            </div>
                                                            <h5 class="fs-16">My Profile</h5>
                                                            <p class="text-muted mb-0">Update your information</p>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                            <div class="col-md-3 col-sm-6 mb-3">
                                                <a href="{% url 'charter' %}" class="btn btn-action-card">
                                                    <div class="card action-card h-100">
                                                        <div class="card-body text-center">
                                                            <div class="avatar-sm mx-auto mb-3">
                                                                <span class="avatar-title bg-soft-warning text-warning rounded fs-4">
                                                                    <i class="ri-file-text-line"></i>
                                                                </span>
                                                            </div>
                                                            <h5 class="fs-16">Service Charter</h5>
                                                            <p class="text-muted mb-0">Our service commitments</p>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --primary: #405189;
        --secondary: #3577f1;
        --success: #0ab39c;
        --info: #299cdb;
        --warning: #f7b84b;
        --danger: #f06548;
        --light: #f3f6f9;
        --dark: #212529;
    }

    body {
        {% comment %} background-color: #f5f7fb; {% endcomment %}
        font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Card animations */
    .card-animate {
        transition: all 0.4s;
        border: none;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
    }

    .card-animate:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    /* Button hover effects */
    .btn-hover {
        transition: all 0.3s ease;
    }

    .btn-hover:hover {
        transform: translateY(-2px);
    }

    .btn-hover-shadow {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .btn-hover-shadow:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
    }

    /* Action cards */
    .btn-action-card {
        padding: 0;
        border: none;
        background: transparent;
        width: 100%;
        text-align: left;
    }

    .action-card {
        transition: all 0.3s ease;
        border: 1px solid #eff2f7;
        border-radius: 12px;
    }

    .action-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        border-color: var(--primary);
    }

    /* Table styling */
    .table-card {
        border-radius: 12px;
    }

    .table th {
        font-weight: 600;
        color: #6c757d;
        border-top: none;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .table td {
        vertical-align: middle;
        padding: 16px 12px;
    }

    /* Badge styling */
    .badge {
        font-weight: 500;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 12px;
    }

    /* Counter animation */
    .counter-value {
        font-size: 22px;
        font-weight: 700;
    }

    /* Avatar styling */
    .avatar-sm {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .avatar-title {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Custom background colors */
    .bg-soft-primary {
        background-color: rgba(64, 81, 137, 0.1) !important;
    }

    .bg-soft-success {
        background-color: rgba(10, 179, 156, 0.1) !important;
    }

    .bg-soft-info {
        background-color: rgba(41, 156, 219, 0.1) !important;
    }

    .bg-soft-warning {
        background-color: rgba(247, 184, 75, 0.1) !important;
    }

    .bg-soft-danger {
        background-color: rgba(240, 101, 72, 0.1) !important;
    }

    .bg-soft-secondary {
        background-color: rgba(53, 119, 241, 0.1) !important;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Time-based greeting
        const hour = new Date().getHours();
        let greetingTime = "day";
        
        if (hour < 12) greetingTime = "morning";
        else if (hour < 18) greetingTime = "afternoon";
        else greetingTime = "evening";
        
        // Update greeting if element exists
        const greetingEl = document.querySelector('.fs-16.mb-1');
        if (greetingEl) {
            greetingEl.textContent = `Good ${greetingTime}, {{ user.get_full_name|default:user.username }}!`;
        }
        
        // Counter animation
        const counters = document.querySelectorAll('.counter-value');
        const speed = 200;
        
        counters.forEach(counter => {
            const target = +counter.getAttribute('data-target');
            const count = +counter.innerText;
            const increment = Math.ceil(target / speed);
            
            if (count < target) {
                const updateCount = () => {
                    const current = +counter.innerText;
                    
                    if (current < target) {
                        counter.innerText = Math.ceil(current + increment);
                        setTimeout(updateCount, 1);
                    } else {
                        counter.innerText = target;
                    }
                };
                updateCount();
            } else {
                counter.innerText = target;
            }
        });
        
        // Add hover effects to all buttons
        const buttons = document.querySelectorAll('.btn');
        buttons.forEach(button => {
            button.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });
            
            button.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    });
</script>

{% endblock content %}